using System.Data.Entity.Validation;
using CRMP.Core;
using System;
using System.Collections.Generic;
using System.Web.Mvc;
using CRMP.Models;
using CRMP.Web.Helpers;
using System.Linq;
using CRMP.Utilities;

namespace CRMP.Web.Controllers
{



    public class @@Model.Name@@Controller : BaseController
    {
        AdministrationComponent administrationComponent = new AdministrationComponent();


        // GET: @@Table.Name@@
        public ActionResult Index()
        {
            return View();
        }        
		
		
        public ActionResult List()
        {
            return View();
        }


        public ActionResult GetList(string keyword, int page)
        {
            int total = 0;
            var list = administrationComponent.Search@@Table.Name@@(keyword, page, Constants.PageSize, out total, true);

            return Json(new { @@Table.Name@@List = list, Total = total }, JsonRequestBehavior.AllowGet);
        }

		
        public ActionResult AddForm()
        {
            return View();
        }

        [HttpPost]
        public ActionResult Delete(int id)
        {
             administrationComponent.Delete@@Model.Name@@(id);
            return Json("success", JsonRequestBehavior.AllowGet);
        }

        [HttpPost]
        public ActionResult Save@@Model.Name@@(@@Model.Name@@ViewModel model)
        {
            if (!ModelState.IsValid)
            {
                return JsonFormResponse();
            }
            
            model.CompanyId = 7;
           
                administrationComponent.Save@@Model.Name@@(model);
           
            return JsonFormResponse();
        }



        public ActionResult Get(int id)
        {
            //var company = administrationComponent.GetCompanyById(id);

            var @@Table.Name@@= administrationComponent.Get@@Model.Name@@(id);
            return Json(@@Table.Name@@, JsonRequestBehavior.AllowGet);
        }

		public ActionResult GetLookupLists()
        {

		@@Loop%Rtable%Table.Rtable!=null%var $$Rtable$$List = administrationComponent.Get$$Rtable$$Lookup();@@


            return Json(new
            {
					@@Loop%Rtable%Table.Rtable!=null%     $$Rtable$$GroupList = $$Rtable$$GroupList,@@

            }, JsonRequestBehavior.AllowGet);
        }



    }
}