using System.Data.Entity.Validation;
using CRMP.Core;
using System;
using System.Collections.Generic;
using System.Web.Mvc;
using CRMP.Models;
using CRMP.Web.Helpers;

namespace CRMP.Web.Controllers
{



    public class @@Model.Name@@Controller : BaseController
    {
        AdministrationComponent administrationComponent = new AdministrationComponent();


        // GET: @@Table.Name@@
        public ActionResult Index()
        {
            var list = administrationComponent.Get@@Table.Name@@List();

            return View(list);
        }        

        public ActionResult SearchCompanies(string keyword)
        {
            var list = administrationComponent.Search@@Table.Name@@(keyword);

            return PartialView("@@Table.Name@@List",list);
        }


        public ActionResult GetList(string keyword)
        {
            var list = administrationComponent.Search@@Table.Name@@(keyword);

            return Json(list, JsonRequestBehavior.AllowGet);
        }



        public ActionResult Add(int? id)
        {
            if (id.HasValue)
            {
                var @@Table.Name@@= administrationComponent.Get@@Model.Name@@(id.Value);
                return View(@@Table.Name@@);
            }
            else
                return View();
        }

       // @OtherTablesLookup


        [HttpPost]
        public ActionResult Delete(int id)
        {
             administrationComponent.Delete@@Model.Name@@(id);
            return Json("success", JsonRequestBehavior.AllowGet);
        }

        [HttpPost]
        public ActionResult Save@@Model.Name@@(@@Model.Name@@ViewModel model)
        {
            if (!ModelState.IsValid)
            {
                //throw new Exception();
                return JsonFormResponse();
            }
            
            try
            {
                administrationComponent.Save@@Model.Name@@(model);
            }
            catch (DbEntityValidationException e)
            {
                foreach (var eve in e.EntityValidationErrors)
                {
                    Console.WriteLine("Entity of type \"{0}\" in state \"{1}\" has the following validation errors:",
                        eve.Entry.Entity.GetType().Name, eve.Entry.State);
                    foreach (var ve in eve.ValidationErrors)
                    {
                        Console.WriteLine("- Property: \"{0}\", Error: \"{1}\"",
                            ve.PropertyName, ve.ErrorMessage);
                    }
                }

            }
            catch (Exception ex)
            {
                Console.WriteLine(ex.Message);
            }
            // return Json(company, JsonRequestBehavior.AllowGet);
            return JsonFormResponse();
        }





        public ActionResult Get(int id)
        {
            //var company = administrationComponent.GetCompanyById(id);

            var @@Table.Name@@= administrationComponent.Get@@Model.Name@@(id);
            return Json(@@Table.Name@@, JsonRequestBehavior.AllowGet);
        }
    }
}